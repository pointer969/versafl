/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CreationRowRenderer","./TableUtils","sap/ui/core/Control","sap/m/library","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button"],function(R,T,C,M,O,a,B){"use strict";var b=C.extend("sap.ui.table.CreationRow",{metadata:{library:"sap.ui.table",properties:{applyEnabled:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{cells:{type:"sap.ui.core.Control",multiple:true,singularName:"cell"},toolbar:{type:"sap.ui.core.Toolbar",multiple:false}},events:{apply:{allowPreventDefault:true}}}});b.prototype.setApplyEnabled=function(e){this.setProperty("applyEnabled",e,true);this._updateDefaultToolbar();return this;};b.prototype.setParent=function(p){C.prototype.setParent.apply(this,arguments);this._update();return this;};b.prototype.resetFocus=function(){var i=this._getFirstInteractiveElement();if(i){i.focus();T.selectElementText(i);return true;}return false;};b.prototype.getFocusDomRef=function(){var i=this._getFirstInteractiveElement();if(i){return i;}return C.prototype.getFocusDomRef.apply(this,arguments);};b.prototype._fireApply=function(){var f=false;if(this.fireApply()){f=this.resetFocus();}return f;};b.prototype.onkeydown=function(e){if(this.getApplyEnabled()&&e.ctrlKey&&e.keyCode===13){var f=document.activeElement;f.blur();window.setTimeout(function(){if(!this._fireApply()){f.focus();}}.bind(this),0);}};function c(o){return new O({content:[new a(),new B({text:T.getResourceText("TBL_CREATIONROW_APPLY"),type:M.ButtonType.Emphasized,enabled:o.getApplyEnabled(),press:function(){o._fireApply();}})],style:M.ToolbarStyle.Clear,ariaLabelledBy:[o.getId()+"-label"]});}b.prototype._getToolbar=function(){var t=this.getToolbar();if(!t){if(!this._oDefaultToolbar){this._oDefaultToolbar=c(this);this.addDependent(this._oDefaultToolbar);}t=this._oDefaultToolbar;if(t.data("sap-ui-invalid")){this._updateDefaultToolbar();}}return t;};b.prototype._updateDefaultToolbar=function(){if(this.getToolbar()){if(this._oDefaultToolbar){this._oDefaultToolbar.data("sap-ui-invalid",true);}return;}if(!this._oDefaultToolbar){return;}var A=this._oDefaultToolbar.getContent()[1];A.setEnabled(this.getApplyEnabled());this._oDefaultToolbar.data("sap-ui-invalid",null);};b.prototype._getFirstInteractiveElement=function(){var d=this.getCells();for(var i=0;i<d.length;i++){var o=d[i].getDomRef();var $=T.getCell(this._getTable(),o,true);var I=T.getInteractiveElements($);if(I){return I[0];}}return null;};b.prototype._getCell=function(i){var d=this.getCells();var o=d.filter(function(o){return o.data("sap-ui-colindex")===i;})[0];if(!o){return null;}return o;};b.prototype._getCellDomRef=function(i){var o=this._getCell(i);var d=o?o.getDomRef():null;var $=T.getCell(this._getTable(),d,true);if(!$){return null;}return $;};b.prototype._focusCell=function(i){var o=this._getCellDomRef(i);var I=T.getInteractiveElements(o);if(I){I[0].focus();T.selectElementText(I[0]);return true;}return false;};b.prototype._takeOverKeyboardHandling=function(e){var t=this._getTable();var o=t?t.getDomRef():null;if(!o||!o.contains(document.activeElement)){return false;}var d=T.getCell(this._getTable(),document.activeElement);var f=T.getCellInfo(d);var F=false;if(f.columnIndex!=null&&f.columnIndex>=0){F=this._focusCell(f.columnIndex);}else{F=this.resetFocus();}if(F&&e){e.preventDefault();}return F;};b.prototype._update=function(){var t=this._getTable();if(!t){this.removeAllCells();return;}var d=t.getColumns();this.removeAllCells();for(var i=0,l=d.length;i<l;i++){if(d[i].getVisible()){this.addCell(d[i].getTemplateClone(i,"Creation"));}}};b.prototype._getTable=function(){var p=this.getParent();return T.isA(p,"sap.ui.table.Table")?p:null;};return b;});
